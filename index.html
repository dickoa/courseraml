<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-04-04 Mon 00:50 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Practical Machine Learning : Project</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Ahmadou H. Dicko" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Practical Machine Learning : Project</h1>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
This document is the main project of the pratical machine learning course of the data science specialization.
The document was built using emacs Org-mode Babel and exported to html and 
equivalent Rmarkdown file was also generated because it was required for grading purpose. 
</p>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2"><span class="section-number-2">2</span> Background</h2>
<div class="outline-text-2" id="text-2">
<p>
Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount 
of data about personal activity relatively inexpensively. These type of devices are part of the quantified 
self movement - a group of enthusiasts who take measurements about themselves regularly to improve their health, 
to find patterns in their behavior, or because they are tech geeks. One thing that people regularly do is quantify
how much of a particular activity they do, but they rarely quantify how well they do it. 
In this project, your goal will be to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. 
They were asked to perform barbell lifts correctly and incorrectly in 5 different ways. 
More information is available from the website here: <a href="http://groupware.les.inf.puc-rio.br/har">http://groupware.les.inf.puc-rio.br/har</a> 
(see the section on the Weight Lifting Exercise Dataset).
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3"><span class="section-number-2">3</span> Package used for the analysis</h2>
<div class="outline-text-2" id="text-3">
<p>
We used the following package for this analysis
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #1f5bff;">library</span>(ggplot2)
<span style="color: #1f5bff;">library</span>(mlr)
<span style="color: #1f5bff;">library</span>(dplyr)
<span style="color: #1f5bff;">library</span>(curl)
<span style="color: #1f5bff;">library</span>(lubridate)
<span style="color: #1f5bff;">library</span>(corrplot)
</pre>
</div>

<p>
We can highlight in particular the use of the <code>mlr</code> R package instead of <code>caret</code>. 
The <code>mlr</code> package was chosen because of the cleaner interface and capabilities similar to <code>caret</code>.
</p>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4"><span class="section-number-2">4</span> Reading the data</h2>
<div class="outline-text-2" id="text-4">
<p>
Both training and testing data were pulled from their original url 
</p>

<div class="org-src-container">

<pre class="src src-R">url_train <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ff1f8b;">"https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"</span>
url_test <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ff1f8b;">"https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"</span>
</pre>
</div>

<p>
Data were downloaded once and at each run we test if the file is in right folder
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #00af00;">if</span> (!<span style="color: #ef2929;">file.exists</span>(<span style="color: #ff1f8b;">"data/train.csv"</span>))
    <span style="color: #ef2929;">curl_download</span>(url_train, destfile <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"data/train.csv"</span>, quiet <span style="color: #1f5bff;">=</span> <span style="color: #18b2b2;">TRUE</span>)

<span style="color: #00af00;">if</span> (!<span style="color: #ef2929;">file.exists</span>(<span style="color: #ff1f8b;">"data/test.csv"</span>))
    <span style="color: #ef2929;">curl_download</span>(url_test, destfile <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"data/test.csv"</span>, quiet <span style="color: #1f5bff;">=</span> <span style="color: #18b2b2;">TRUE</span>)
</pre>
</div>

<p>
We then read the data using the <code>read.csv</code> function.
</p>

<div class="org-src-container">

<pre class="src src-R">train <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">read.csv</span>(<span style="color: #ff1f8b;">"data/train.csv"</span>,
                 stringsAsFactors <span style="color: #1f5bff;">=</span> <span style="color: #18b2b2;">FALSE</span>,
                 na.strings <span style="color: #1f5bff;">=</span> <span style="color: #ef2929;">c</span>(<span style="color: #ff1f8b;">"#DIV/0!"</span>, <span style="color: #18b2b2;">NA</span>),
                 row.names <span style="color: #1f5bff;">=</span> 1)

test <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">read.csv</span>(<span style="color: #ff1f8b;">"data/test.csv"</span>,
                stringsAsFactors <span style="color: #1f5bff;">=</span> <span style="color: #18b2b2;">FALSE</span>,
                na.strings <span style="color: #1f5bff;">=</span> <span style="color: #ef2929;">c</span>(<span style="color: #ff1f8b;">"#DIV/0!"</span>, <span style="color: #18b2b2;">NA</span>),
                row.names <span style="color: #1f5bff;">=</span> 1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9"><span class="section-number-2">5</span> Cleaning the data</h2>
<div class="outline-text-2" id="text-5">
<p>
Before fitting a model and predicting user movement, we need to create some features and 
remove some of them.
</p>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">5.1</span> Creating new features and remove all NA features</h3>
<div class="outline-text-3" id="text-5-1">
<p>
In this step we created the hour of the day when the movement were recorded and we turned
all the character to factor.
</p>

<div class="org-src-container">

<pre class="src src-R">train$raw_timestamp_part_1 <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">as.POSIXct</span>(train$raw_timestamp_part_1, origin <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"1970-01-01"</span>)
test$raw_timestamp_part_1 <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">as.POSIXct</span>(test$raw_timestamp_part_1, origin <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"1970-01-01"</span>)
train$hour <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">hour</span>(train$raw_timestamp_part_1)
test$hour <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">hour</span>(test$raw_timestamp_part_1)
train$classe <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">factor</span>(train$classe)
train$user_name <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">factor</span>(train$user_name)
test$user_name <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">factor</span>(test$user_name)
train$new_window <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">as.integer</span>(<span style="color: #ef2929;">factor</span>(train$new_window)) <span style="color: #1f5bff;">-</span> 1
test$new_window <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">as.integer</span>(<span style="color: #ef2929;">factor</span>(test$new_window)) <span style="color: #1f5bff;">-</span> 1
</pre>
</div>

<p>
We also removed all null column (full of missing values) and kept the hour instead of the timestamp.
</p>

<div class="org-src-container">

<pre class="src src-R">ind <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">sapply</span>(train, <span style="color: #00af00;">function</span>(x) <span style="color: #ef2929;">all</span>(<span style="color: #ef2929;">is.na</span>(x)))
train <span style="color: #1f5bff;">&lt;-</span> train[, !ind]
test <span style="color: #1f5bff;">&lt;-</span> test[, !ind]
toremove <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">c</span>(<span style="color: #ff1f8b;">"raw_timestamp_part_1"</span>,
             <span style="color: #ff1f8b;">"raw_timestamp_part_2"</span>,
             <span style="color: #ff1f8b;">"cvtd_timestamp"</span>)
ind <span style="color: #1f5bff;">&lt;-</span> !<span style="color: #ef2929;">names</span>(train) <span style="color: #1f5bff;">%</span><span style="color: #00af00;">in</span><span style="color: #1f5bff;">%</span> toremove
train <span style="color: #1f5bff;">&lt;-</span> train[, ind]
test <span style="color: #1f5bff;">&lt;-</span> test[, ind]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">5.2</span> Create a task a remove near constant features</h3>
<div class="outline-text-3" id="text-5-2">
<p>
In order to use the <code>mlr</code> package, we need to create a <code>task</code>.
In this analysis, we are doing classifcation therefore we can use the <code>makeClassifTask</code> function.
Constant features were also removed from the rest of the analysis.
</p>

<div class="org-src-container">

<pre class="src src-R">task <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">makeClassifTask</span>(id <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"fitbits_pred"</span>, data <span style="color: #1f5bff;">=</span> train, target <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"classe"</span>)
task <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">removeConstantFeatures</span>(task, perc <span style="color: #1f5bff;">=</span> 0.05)
task
</pre>
</div>

<pre class="example">
Removing 95 columns: new_window,kurtosis_roll_belt,kurtosis_picth_belt,skewness_roll_belt,skewness_roll_belt.1,max_roll_belt,max_picth_belt,max_yaw_belt,min_roll_belt,min_pitch_belt,min_yaw_belt,amplitude_roll_belt,amplitude_pitch_belt,amplitude_yaw_belt,var_total_accel_belt,avg_roll_belt,stddev_roll_belt,var_roll_belt,avg_pitch_belt,stddev_pitch_belt,var_pitch_belt,avg_yaw_belt,stddev_yaw_belt,var_yaw_belt,var_accel_arm,avg_roll_arm,stddev_roll_arm,var_roll_arm,avg_pitch_arm,stddev_pitch_arm,var_pitch_arm,avg_yaw_arm,stddev_yaw_arm,var_yaw_arm,kurtosis_roll_arm,kurtosis_picth_arm,kurtosis_yaw_arm,skewness_roll_arm,skewness_pitch_arm,skewness_yaw_arm,max_roll_arm,max_picth_arm,max_yaw_arm,min_roll_arm,min_pitch_arm,min_yaw_arm,amplitude_roll_arm,amplitude_pitch_arm,amplitude_yaw_arm,kurtosis_roll_dumbbell,kurtosis_picth_dumbbell,skewness_roll_dumbbell,skewness_pitch_dumbbell,max_roll_dumbbell,max_picth_dumbbell,max_yaw_dumbbell,min_roll_dumbbell,min_pitch_dumbbell,min_yaw_dumbbell,amplitude_roll_dumbbell,amplitude_pitch_dumbbell,amplitude_yaw_dumbbell,var_accel_dumbbell,avg_roll_dumbbell,stddev_roll_dumbbell,var_roll_dumbbell,avg_pitch_dumbbell,stddev_pitch_dumbbell,var_pitch_dumbbell,avg_yaw_dumbbell,stddev_yaw_dumbbell,var_yaw_dumbbell,kurtosis_roll_forearm,kurtosis_picth_forearm,skewness_roll_forearm,skewness_pitch_forearm,max_roll_forearm,max_picth_forearm,max_yaw_forearm,min_roll_forearm,min_pitch_forearm,min_yaw_forearm,amplitude_roll_forearm,amplitude_pitch_forearm,amplitude_yaw_forearm,var_accel_forearm,avg_roll_forearm,stddev_roll_forearm,var_roll_forearm,avg_pitch_forearm,stddev_pitch_forearm,var_pitch_forearm,avg_yaw_forearm,stddev_yaw_forearm,var_yaw_forearm
Supervised task: fitbits_pred
Type: classif
Target: classe
Observations: 19622
Features:
numerics  factors  ordered 
      54        1        0 
Missings: FALSE
Has weights: FALSE
Has blocking: FALSE
Classes: 5
   A    B    C    D    E 
5580 3797 3422 3216 3607 
Positive class: NA
</pre>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">5.3</span> Filter feature a remove non important variables</h3>
<div class="outline-text-3" id="text-5-3">
<p>
We filtered the data and kept the 25% most important variable based on the information gain of each variable (based on a randomForest model). 
</p>

<div class="org-src-container">

<pre class="src src-R">fv <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">generateFilterValuesData</span>(task, method <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"information.gain"</span>)
task <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">filterFeatures</span>(task, fval <span style="color: #1f5bff;">=</span> fv, perc <span style="color: #1f5bff;">=</span> 0.25, mandatory.feat <span style="color: #1f5bff;">=</span> <span style="color: #ef2929;">c</span>(<span style="color: #ff1f8b;">"user_name"</span>, <span style="color: #ff1f8b;">"hour"</span>))
task
</pre>
</div>

<pre class="example">
R&gt; Supervised task: fitbits_pred
Type: classif
Target: classe
Observations: 19622
Features:
numerics  factors  ordered 
      13        1        0 
Missings: FALSE
Has weights: FALSE
Has blocking: FALSE
Classes: 5
   A    B    C    D    E 
5580 3797 3422 3216 3607 
Positive class: NA
</pre>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">5.4</span> Check the final and most important variables</h3>
<div class="outline-text-3" id="text-5-4">
<p>
In order to check the final variable, a corrplot was used. The first and last (15) features are factors, they were thus removed 
before computing the linear correlation. 
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #ef2929;">corrplot</span>(<span style="color: #ef2929;">cor</span>(<span style="color: #ef2929;">getTaskData</span>(task)[<span style="color: #1f5bff;">-</span><span style="color: #ef2929;">c</span>(1, 15)], use <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"pairwise"</span>))
</pre>
</div>


<div class="figure">
<p><img src="./fig/corplot.png" alt="corplot.png" />
</p>
</div>

<p>
Based on the graph, we just have two variables that are highly correlated (<code>accel_belt_z</code> and <code>roll_belt</code>).
</p>
</div>
</div>
</div>


<div id="outline-container-orgheadline16" class="outline-2">
<h2 id="orgheadline16"><span class="section-number-2">6</span> RandomForest model to predict</h2>
<div class="outline-text-2" id="text-6">
<p>
For this analysis we decided to use <code>randomForest</code> to predict user movement because of the
high accuracy and robustness of this model which an enhanced version of the popular bagging.
</p>
</div>

<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12"><span class="section-number-3">6.1</span> Model tuning and model evaluation</h3>
<div class="outline-text-3" id="text-6-1">
<p>
We used a 10-fold cross validation to select the best parameters and evaluation the model.
In the RandomForest model, the two most important parameters are the number of variable that sample
at each run of the algorithm (<code>mtry</code>) and the number of tree since when use regression trees as base learner (<code>ntree</code>).
</p>
</div>


<div id="outline-container-orgheadline10" class="outline-4">
<h4 id="orgheadline10"><span class="section-number-4">6.1.1</span> Set the learner</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
We set the learner using makeLearner function
</p>

<div class="org-src-container">

<pre class="src src-R">rflrn <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">makeLearner</span>(<span style="color: #ff1f8b;">"classif.randomForest"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline11" class="outline-4">
<h4 id="orgheadline11"><span class="section-number-4">6.1.2</span> Cross-validation to select hyperparameters and evaluate the model</h4>
<div class="outline-text-4" id="text-6-1-2">
<p>
A 10-fold cross-validation is used to select the best parameters and evaluate
the model for this parameters
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #ef2929;">set.seed</span>(1)
rdesc <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">makeResampleDesc</span>(<span style="color: #ff1f8b;">"CV"</span>,
                         iters <span style="color: #1f5bff;">=</span> 10,
                         predict <span style="color: #1f5bff;">=</span> <span style="color: #ff1f8b;">"test"</span>)
ps <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">makeParamSet</span>(<span style="color: #ef2929;">makeIntegerParam</span>(<span style="color: #ff1f8b;">"mtry"</span>, lower <span style="color: #1f5bff;">=</span> 2, upper <span style="color: #1f5bff;">=</span> 10),
                  <span style="color: #ef2929;">makeIntegerParam</span>(<span style="color: #ff1f8b;">"ntree"</span>, lower <span style="color: #1f5bff;">=</span> 500, upper <span style="color: #1f5bff;">=</span> 5000))
ctrl <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">makeTuneControlGrid</span>()
tune <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">tuneParams</span>(rflrn, task <span style="color: #1f5bff;">=</span> task,
                 resampling <span style="color: #1f5bff;">=</span> rdesc,
                 par.set <span style="color: #1f5bff;">=</span> ps,
                 control <span style="color: #1f5bff;">=</span> ctrl)
</pre>
</div>

<p>
The model has very high predictive power, with an misclassification error rates of 
<code>0.06%</code> based on the 10-fold cross-validation. The optimal <code>mtry</code> and <code>ntree</code> are respectively 6 and 5000.
</p>

<pre class="example">
Tune result:
Op. pars: mtry=6; ntree=5000
mmce.test.mean=0.000662
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">6.2</span> Prediction</h3>
<div class="outline-text-3" id="text-6-2">
<p>
We can then set the parameters and predict on both training and testing set
</p>
<div class="org-src-container">

<pre class="src src-R">rflrn_tune <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">setHyperPars</span>(rflrn, par.vals <span style="color: #1f5bff;">=</span> tune$x)
mod <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">train</span>(rflrn_tune, task)
mod
</pre>
</div>

<pre class="example">
R&gt; Model for learner.id=classif.randomForest; learner.class=classif.randomForest
Trained on: task.id = fitbits_pred; obs = 19622; features = 14
Hyperparameters: mtry=6,ntree=5000
</pre>
</div>

<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">6.2.1</span> Prediction on training set</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
We have a perfect prediction on training set, which is not a surprise, since the cross-validated
misclassification error is close to 0.
</p>

<div class="org-src-container">

<pre class="src src-R">predtrain <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">predict</span>(mod, task <span style="color: #1f5bff;">=</span> task)
<span style="color: #ef2929;">table</span>(predtrain$data[,<span style="color: #1f5bff;">-</span>1])
</pre>
</div>

<pre class="example">
     response
truth    A    B    C    D    E
    A 5580    0    0    0    0
    B    0 3797    0    0    0
    C    0    0 3422    0    0
    D    0    0    0 3216    0
    E    0    0    0    0 3607
</pre>

<p>
A misclassification error of 0
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #ef2929;">performance</span>(predtrain)
</pre>
</div>

<pre class="example">
mmce 
   0
</pre>
</div>
</div>


<div id="outline-container-orgheadline14" class="outline-4">
<h4 id="orgheadline14"><span class="section-number-4">6.2.2</span> Prediction on testing set</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
Finally we can predict on the testing set and based on the cross-validated misclassification error, 
we can also expect some good prediction.
</p>

<div class="org-src-container">

<pre class="src src-R">predtest <span style="color: #1f5bff;">&lt;-</span> <span style="color: #ef2929;">predict</span>(mod$learner.model, newdata <span style="color: #1f5bff;">=</span> test)
predtest
</pre>
</div>

<pre class="example">
 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 
 B  A  B  A  A  E  D  B  A  A  B  C  B  A  E  E  A  B  B  B 
Levels: A B C D E
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Ahmadou H. Dicko</p>
<p class="date">Created: 2016-04-04 Mon 00:50</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>